int p = 0;      
int dir = 1;  

const unsigned long PERIOD_US = 5000; 

void setup() {
  pinMode(13, OUTPUT);
}

void loop() {
  unsigned long t0 = micros();

  while (micros() - t0 < PERIOD_US) {
    unsigned long e = micros() - t0;

    unsigned long onTime = (unsigned long)p * PERIOD_US / 255UL;

    digitalWrite(13, (e < onTime) ? HIGH : LOW);
  }

  p += dir;
  if (p >= 255) { p = 255; dir = -1; }
  if (p <= 0)   { p = 0;   dir =  1; }
}
